<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Audio playback app</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
			crossorigin="anonymous" />
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
			crossorigin="anonymous"></script>
		<link rel="stylesheet" href="../css/bootstrap.dark.css" />
		<link rel="stylesheet" href="../css/materialDesign.css" />
		<link rel="stylesheet" href="./css/main.css" />
		<script src="../js/ClassHelpers.js"></script>
		<script src="./js/includeContent.js"></script>
		<script src="./js/requirements.js"></script>
		<script src="./js/recorder.js"></script>
		<script src="./js/voiceApp.js"></script>
	</head>
	<!-- TODO: make responsive -->

	<body class="dark mt-6">
		<div id="requirements">
			<div id="audio" class="danger-text">
				<include src="./resources/SVGs/NoSound.svg"></include>
				<!-- TODO: Create volume control app -->
				<!-- https://stackoverflow.com/questions/33747398/html-audio-tag-volume#answers -->
			</div>
			<div id="microphone" class="danger-text">
				<include src="./resources/SVGs/NoMic.svg"></include>
			</div>
		</div>
		<div id="player" class="surface">
			<div id="actionButton">
				<include src="./resources/SVGs/RecordButton.svg"></include>
			</div>
			<span class="textfield">Start recording...</span>
			<div id="waveforms">
				<include src="./resources/SVGs/Soundwaves.svg" style="display: none;"></include>
			</div>
		</div>
		<script>
			// content update
			replaceIncludes()

			var actionButtonDOM = document.getElementById("actionButton")
			var textfieldDOM = document.querySelector("span.textfield")
			var audioReqDOM = document.getElementById("audio")
			var micReqDOM = document.getElementById("microphone")
			var waveformsDOM = document.querySelector("#waveforms")

			var settings = VoiceAppSettings
			// settings.immediateReview = true; // TODO: this feature gives error the second time
			// settings.autoContinueAfterPlayed = false; // TODO: this feature doesnt work

			var voiceApp = new VoiceApp(actionButtonDOM, textfieldDOM, settings)
			var reqManager = new RequirementStateManager(audioReqDOM, micReqDOM)
			document.addEventListener(RecorderEvents.onRecordPermsUpdate, (e) => {
				reqManager.setMicImage(e.detail.IsRecAllowed ? MicStates.Mic : MicStates.NoMic)
			})

			actionButtonDOM.addEventListener("click", () => { voiceApp.nextState() })
		</script>
	</body>

</html>