<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Chess 2</title>
		<link rel="shortcut icon" href="resources/icons/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" href="../../css/bootstrap.dark.css" />
		<link rel="stylesheet" href="../../css/materialDesign.css" />
		<link rel="stylesheet" href="../../modules/css/popup.css" />
		<link rel="stylesheet" href="../../modules/css/formControls.css">
		<link rel="stylesheet" href="../../modules/css/inputNotifier.css">
		<link rel="stylesheet" href="./css/main.css" />
		<link rel="stylesheet" href="./css/chess.css">
		<link rel="stylesheet" href="./css/history.css">
		<script src="../../modules/js/inputNotifierManager.js"></script>
		<script src="../../modules/js/includeContent.js"></script>
		<script src="../../modules/js/includePopups.js"></script>
		<script src="../../modules/js/storageManager.js"></script>
		<script src="../../modules/js/shortcutManager.js"></script>
		<script src="./js/modules/vec.js"></script>
		<script src="./js/modules/stringHelper.js"></script>
		<script src="./js/chess/boardPositionsMap.js"></script>
		<script src="./js/chess/chess.js"></script>
		<script src="./js/chess/board.js"></script>
		<script src="./js/chess/chessUI.js"></script>
		<script src="./js/chess/pieces.js"></script>
		<script src="./js/chess/turn.js"></script>
		<script src="./js/chess/history.js"></script>
	</head>

	<body class="dark">
		<div id="pageButtons">
			<div id="swapSidesBtn" class="button">
				<svg width="44" height="44" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path
						d="M2.93334 44C4.55308 44 5.86667 42.6883 5.86667 41.0667V34.2751C9.52417 39.3691 15.4551 42.5333 22 42.5333C30.6625 42.5333 38.2625 37.0021 40.9219 28.7651C41.4203 27.2241 40.5738 25.5676 39.0325 25.0727C37.4844 24.5685 35.8352 25.4221 35.3384 26.9601C33.4675 32.7708 28.1051 36.6667 22 36.6667C17.3708 36.6667 13.1761 34.4163 10.5967 30.8H14.6667C16.2864 30.8 17.6 29.4883 17.6 27.8667C17.6 26.2451 16.2864 24.9333 14.6667 24.9333H2.93333C1.31358 24.9333 -1.41755e-07 26.2451 0 27.8667L1.15399e-06 41.0667C1.29575e-06 42.6883 1.31084 44 2.93334 44ZM4.96833 18.92C6.51933 19.4185 8.16567 18.5705 8.66251 17.0325C10.5325 11.2292 15.8949 7.33334 22 7.33334C26.6292 7.33334 30.8229 9.58375 33.4033 13.2H29.3333C27.7136 13.2 26.4 14.5117 26.4 16.1333C26.4 17.7549 27.7136 19.0667 29.3333 19.0667H41.0667C42.6864 19.0667 44 17.7549 44 16.1333V2.93334C44 1.31175 42.6864 -1.41602e-07 41.0667 0C39.4469 1.41603e-07 38.1333 1.31175 38.1333 2.93334V9.72492C34.4759 4.62916 28.5449 1.46667 22.0825 1.46667C13.4245 1.46667 5.82084 6.99784 3.1625 15.2351C2.57584 16.7751 3.42833 18.5075 4.96833 18.92Z"
						fill="currentColor" />
				</svg>
			</div>
			<div id="settingsBtn" class="button">
				<svg width="44" height="44" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path
						d="M38.8304 24.145C38.9153 23.4575 38.9718 22.7425 38.9718 22C38.9718 21.2575 38.9153 20.5425 38.8021 19.855L43.5825 16.225C44.0068 15.895 44.1199 15.29 43.8654 14.8225L39.3396 7.205C39.0567 6.71 38.4627 6.545 37.9535 6.71L32.3245 8.91C31.1365 8.03 29.8919 7.315 28.5059 6.765L27.6573 0.935C27.5724 0.385 27.0915 0 26.5258 0H17.4742C16.9085 0 16.4559 0.385 16.371 0.935L15.5224 6.765C14.1364 7.315 12.8635 8.0575 11.7038 8.91L6.07477 6.71C5.56561 6.5175 4.9716 6.71 4.68874 7.205L0.162916 14.8225C-0.119947 15.3175 -0.00680151 15.895 0.445781 16.225L5.22618 19.855C5.11303 20.5425 5.02817 21.285 5.02817 22C5.02817 22.715 5.08475 23.4575 5.19789 24.145L0.417494 27.775C-0.00680216 28.105 -0.119947 28.71 0.13463 29.1775L4.66045 36.795C4.94331 37.29 5.53733 37.455 6.04648 37.29L11.6755 35.09C12.8635 35.97 14.1081 36.685 15.4941 37.235L16.3427 43.065C16.4559 43.615 16.9085 44 17.4742 44H26.5258C27.0915 44 27.5724 43.615 27.629 43.065L28.4776 37.235C29.8636 36.685 31.1365 35.9425 32.2962 35.09L37.9252 37.29C38.4344 37.4825 39.0284 37.29 39.3113 36.795L43.8371 29.1775C44.1199 28.6825 44.0068 28.105 43.5542 27.775L38.8304 24.145ZM22 30.25C17.3328 30.25 13.5141 26.5375 13.5141 22C13.5141 17.4625 17.3328 13.75 22 13.75C26.6673 13.75 30.4859 17.4625 30.4859 22C30.4859 26.5375 26.6673 30.25 22 30.25Z"
						fill="currentColor" />
				</svg>
			</div>
		</div>
		<div class="container-full">
			<div id="board1" class="board" turn="w">
				<div class="jail white">
					<div class="square" data-id="wj5"></div>
					<div class="square" data-id="wj4"></div>
				</div>
				<div class="inner-board">
					<div class="marks top">
						<span>A</span>
						<span>B</span>
						<span>C</span>
						<span>D</span>
						<span>E</span>
						<span>F</span>
						<span>G</span>
						<span>H</span>
					</div>
					<div class="marks left">
						<span>8</span>
						<span>7</span>
						<span>6</span>
						<span>5</span>
						<span>4</span>
						<span>3</span>
						<span>2</span>
						<span>1</span>
					</div>
					<div class="marks right">
						<span>8</span>
						<span>7</span>
						<span>6</span>
						<span>5</span>
						<span>4</span>
						<span>3</span>
						<span>2</span>
						<span>1</span>
					</div>
					<div class="marks bottom">
						<span>A</span>
						<span>B</span>
						<span>C</span>
						<span>D</span>
						<span>E</span>
						<span>F</span>
						<span>G</span>
						<span>H</span>
					</div>
					<div class="thicc-wall">
						<div class="play-board">
							<div class="squares">
								<div class="row">
									<div class="square" data-id="a8"></div>
									<div class="square" data-id="b8"></div>
									<div class="square" data-id="c8"></div>
									<div class="square" data-id="d8"></div>
									<div class="square" data-id="e8"></div>
									<div class="square" data-id="f8"></div>
									<div class="square" data-id="g8"></div>
									<div class="square" data-id="h8"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a7"></div>
									<div class="square" data-id="b7"></div>
									<div class="square" data-id="c7"></div>
									<div class="square" data-id="d7"></div>
									<div class="square" data-id="e7"></div>
									<div class="square" data-id="f7"></div>
									<div class="square" data-id="g7"></div>
									<div class="square" data-id="h7"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a6"></div>
									<div class="square" data-id="b6"></div>
									<div class="square" data-id="c6"></div>
									<div class="square" data-id="d6"></div>
									<div class="square" data-id="e6"></div>
									<div class="square" data-id="f6"></div>
									<div class="square" data-id="g6"></div>
									<div class="square" data-id="h6"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a5"></div>
									<div class="square" data-id="b5"></div>
									<div class="square" data-id="c5"></div>
									<div class="square" data-id="d5"></div>
									<div class="square" data-id="e5"></div>
									<div class="square" data-id="f5"></div>
									<div class="square" data-id="g5"></div>
									<div class="square" data-id="h5"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a4"></div>
									<div class="square" data-id="b4"></div>
									<div class="square" data-id="c4"></div>
									<div class="square" data-id="d4"></div>
									<div class="square" data-id="e4"></div>
									<div class="square" data-id="f4"></div>
									<div class="square" data-id="g4"></div>
									<div class="square" data-id="h4"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a3"></div>
									<div class="square" data-id="b3"></div>
									<div class="square" data-id="c3"></div>
									<div class="square" data-id="d3"></div>
									<div class="square" data-id="e3"></div>
									<div class="square" data-id="f3"></div>
									<div class="square" data-id="g3"></div>
									<div class="square" data-id="h3"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a2"></div>
									<div class="square" data-id="b2"></div>
									<div class="square" data-id="c2"></div>
									<div class="square" data-id="d2"></div>
									<div class="square" data-id="e2"></div>
									<div class="square" data-id="f2"></div>
									<div class="square" data-id="g2"></div>
									<div class="square" data-id="h2"></div>
								</div>
								<div class="row">
									<div class="square" data-id="a1"></div>
									<div class="square" data-id="b1"></div>
									<div class="square" data-id="c1"></div>
									<div class="square" data-id="d1"></div>
									<div class="square" data-id="e1"></div>
									<div class="square" data-id="f1"></div>
									<div class="square" data-id="g1"></div>
									<div class="square" data-id="h1"></div>
								</div>
								<div class="centerSquare">
									<div class="square" data-id="c"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="jail black">
					<div class="square" data-id="bj5"></div>
					<div class="square" data-id="bj4"></div>
				</div>
			</div>
			<div class="historyBoard">
				<div class="history">
					<div class="colName">#</div>
					<div class="colName">White</div>
					<div class="colName">Black</div>
				</div>
				<div class="inputContainer">
					<input type="text" id="moveInput" placeholder="move (eg. Me3)" data-placement="bottom" data-color="danger">
					<div id="moveInputSend" class="send">
						<svg width="80%" height="80%" viewBox="0 0 38 38" color="inherit" xmlns="http://www.w3.org/2000/svg">
							<path
								d="M10.2004 9.95668L31 19L10.2004 28.0433C9.38527 28.3977 8.54749 27.5922 8.86963 26.7638L11.2805 20.5645C11.4154 20.2175 11.732 19.9742 12.102 19.9331L20.5 19L12.102 18.0669C11.732 18.0258 11.4154 17.7825 11.2805 17.4355L8.86963 11.2362C8.54749 10.4078 9.38527 9.60229 10.2004 9.95668Z"
								fill="currentcolor" />
						</svg>
					</div>
				</div>
			</div>
		</div>
		<!-- #region popups -->
		<popup src="./popups/Settings.html" id="settingsPopup"></popup>
		<!-- #endregion -->
		<script>
			/* game */
			let board = document.getElementById("board1")
			let boardHistory = document.querySelector(".historyBoard")
			let game = new Chess(board, boardHistory)

			// ShortcutManager
			var shortcutManager = new ShortcutManager()

			// swap sides
			var swapSidesBtn = document.getElementById("swapSidesBtn")
			swapSidesBtn.addEventListener("click", () => {
				let board = document.getElementById("board1")
				if (board.classList.contains("black-view"))
					board.classList.remove("black-view")
				else
					board.classList.add("black-view")
			})

			// Settings
			var settingsBtn = document.getElementById("settingsBtn")
			includePopup("settingsPopup")
				.then((settingsPopup) => {
					settingsBtn.addEventListener("click", () => { settingsPopup.classList.add("show") })
					shortcutManager.addShortcut(new Shortcut(KeyCodes.KeyI, new ShortcutMod(undefined, true), KeyActions.keyDown), function() { settingsPopup.classList.add("show") })
					shortcutManager.addShortcut(new Shortcut(KeyCodes.Enter, undefined, KeyActions.keyDown), function() { settingsPopup.classList.remove("show") }, true)
					shortcutManager.addShortcut(new Shortcut(KeyCodes.Escape, undefined, KeyActions.keyDown), function() { settingsPopup.classList.remove("show") }, true)
					settingsPopup.querySelector(".overlay").addEventListener("click", () => { settingsPopup.classList.remove("show") })

					/* restart */
					settingsPopup.querySelector("#restart").addEventListener("click", () => {
						game.restart()
					})

					/* show history setting */
					let showHistoryCheckbox = settingsPopup.querySelector("#showHistory");
					if (LocalDataStorage.exists("showHistory")) {
						if (LocalDataStorage.get("showHistory") === "false") {
							boardHistory.classList.add("hide");
							showHistoryCheckbox.checked = false
						}
					}
					showHistoryCheckbox.addEventListener("change", (e) => {
						let showHistory = showHistoryCheckbox.checked
						LocalDataStorage.set("showHistory", showHistory)

						if (showHistory)
							boardHistory.classList.remove("hide");
						else
							boardHistory.classList.add("hide");

					})
				})
		</script>
	</body>

</html>