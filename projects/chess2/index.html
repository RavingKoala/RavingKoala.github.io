<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Audio playback app</title>
		<link rel="stylesheet" href="../../css/bootstrap.dark.css" />
		<link rel="stylesheet" href="../../css/materialDesign.css" />
		<link rel="stylesheet" href="./css/main.css" />
		<link rel="stylesheet" href="./css/chess.css">
	</head>

	<body class="dark">
		<div class="container-thin">
			<div class="board">
				<div id="t1" class="tile"></div>
				<div id="t2" class="tile"></div>
				<div id="t3" class="tile">
					<div class="piece we"></div>
				</div>
				<div id="t4" class="tile"></div>
				<div id="t5" class="tile"></div>
				<div id="t6" class="tile"></div>
				<div id="t7" class="tile"></div>
				<div id="t8" class="tile"></div>
				<div id="t9" class="tile"></div>
				<div id="t10" class="tile"></div>
				<div id="t11" class="tile"></div>
				<div id="t12" class="tile"></div>
				<div id="t13" class="tile"></div>
				<div id="t14" class="tile"></div>
				<div id="t15" class="tile"></div>
				<div id="t16" class="tile"></div>
			</div>
		</div>

		<script>
			(() => {
				class Vec2 {
					constructor (x, y) {
						this.x = x
						this.y = y
					}
					static get zero() {
						return new Vec2(0, 0)
					}
				}

				let dragging
				let draggingDOM
				let originPos

				function drag_reset() {
					if (draggingDOM != null) {
						draggingDOM.classList.remove("dragging")
						draggingDOM.style.transform = "translate(0, 0)"
						draggingDOM = undefined
					}
					originPos = Vec2.zero
					dragging = false
				}

				function drag_cancel() {
					drag_reset()
				}

				function drag_move(pos) {
					if (!draggingDOM instanceof HTMLElement
						|| !pos instanceof Vec2)
						throw new Error("something went wrong somewhere!")

					draggingDOM.style.transform = "translate(" + pos.x + "px, " + pos.y + "px)";
				}

				function move(destDOM) {
					destDOM.appendChild(draggingDOM)
				}

				document.querySelectorAll(".piece").forEach((piece) => {
					piece.addEventListener("mousedown", (e) => {
						e.preventDefault();
						if (dragging)
							drag_cancel()

						piece.classList.add("dragging")
						dragging = true
						originPos = new Vec2(e.clientX, e.clientY)
						draggingDOM = piece
					})
				})
				document.querySelectorAll(".tile").forEach((tile) => {
					tile.addEventListener("mouseover", (e) => {
						if (dragging)
							tile.style.boxShadow = "inset 0 0 0 5px #00000025"
					})
					tile.addEventListener("mouseleave", (e) => {
						if (dragging)
							tile.style.boxShadow = ""
					})
					tile.addEventListener("mouseup", (e) => {
						move(tile)
					})
				})
				document.addEventListener("mouseup", (e) => {
					drag_cancel()
				})
				document.addEventListener("mousemove", (e) => {
					if (dragging) {
						drag_move(new Vec2(e.clientX - originPos.x, e.clientY - originPos.y))
					}
				})
			})()

		</script>
	</body>

</html>